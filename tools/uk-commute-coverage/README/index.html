<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title> | jamesmunro.github.io</title>
    <meta name="site-version" content="20260122.2201">
    <link rel="icon" href="data:,">
    <style>
      :root {
        color-scheme: light;
        font-family: "Segoe UI", system-ui, -apple-system, sans-serif;

        /* Light mode colors */
        --bg-primary: #f5f7fb;
        --bg-card: #fff;
        --bg-secondary: #f4f6fb;
        --bg-secondary-hover: #eef2fb;
        --bg-output: #f6f8ff;
        --text-primary: #1f2a44;
        --text-secondary: #5b6884;
        --text-tertiary: #56637e;
        --border-color: #d4d9e6;
        --border-card: rgba(153, 176, 234, 0.3);
        --border-hover: #99b0ea;
        --link-color: #3559a2;
        --link-hover: #2b4a89;
        --error-color: #b42318;
        --header-gradient-1: #1f3f7a;
        --header-gradient-2: #3559a2;
        --header-text: #fff;
        --shadow-card: rgba(31, 42, 68, 0.08);
        --shadow-header: rgba(31, 63, 122, 0.25);
        --shadow-hover: rgba(53, 89, 162, 0.12);

        background: var(--bg-primary);
        color: var(--text-primary);
      }

      :root.dark-mode {
        color-scheme: dark;

        /* Dark mode colors */
        --bg-primary: #0f1419;
        --bg-card: #1a1f2e;
        --bg-secondary: #151b26;
        --bg-secondary-hover: #1f2738;
        --bg-output: #13181f;
        --text-primary: #e6edf3;
        --text-secondary: #9198a1;
        --text-tertiary: #7d8590;
        --border-color: #30363d;
        --border-card: rgba(99, 110, 234, 0.3);
        --border-hover: #636eea;
        --link-color: #6b8aff;
        --link-hover: #8ca6ff;
        --error-color: #f85149;
        --header-gradient-1: #161b33;
        --header-gradient-2: #1f2d52;
        --header-text: #e6edf3;
        --shadow-card: rgba(0, 0, 0, 0.3);
        --shadow-header: rgba(0, 0, 0, 0.4);
        --shadow-hover: rgba(99, 110, 234, 0.2);
      }

      body {
        margin: 0;
        line-height: 1.6;
      }

      header {
        background: linear-gradient(120deg, var(--header-gradient-1), var(--header-gradient-2));
        color: var(--header-text);
        padding: 56px 24px 64px;
        box-shadow: 0 12px 30px var(--shadow-header);
        position: relative;
      }

      header h1 {
        margin: 0 0 12px;
        font-size: 2.4rem;
      }

      header p {
        margin: 0;
        max-width: 640px;
        opacity: 0.9;
      }

      .theme-toggle {
        position: absolute;
        top: 20px;
        right: 24px;
        background: rgba(255, 255, 255, 0.15);
        border: 1px solid rgba(255, 255, 255, 0.25);
        border-radius: 20px;
        padding: 8px 16px;
        color: var(--header-text);
        cursor: pointer;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.2s ease;
        backdrop-filter: blur(10px);
      }

      .theme-toggle:hover {
        background: rgba(255, 255, 255, 0.25);
        transform: translateY(-1px);
      }

      .theme-toggle:active {
        transform: translateY(0);
      }

      main {
        max-width: 1080px;
        margin: -32px auto 64px;
        padding: 0 24px;
      }

      .card {
        background: var(--bg-card);
        border-radius: 16px;
        box-shadow: 0 16px 40px var(--shadow-card);
        border: 1px solid var(--border-card);
        padding: 28px;
        margin-bottom: 32px;
      }

      .tool-index {
        display: grid;
        gap: 16px;
      }

      .tool-index a {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 18px 20px;
        background: var(--bg-secondary);
        border-radius: 12px;
        text-decoration: none;
        color: inherit;
        border: 1px solid transparent;
        transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
      }

      .tool-index a:hover {
        border-color: var(--border-hover);
        background: var(--bg-secondary-hover);
        box-shadow: 0 10px 18px var(--shadow-hover);
        transform: translateY(-2px);
      }

      .tool-meta {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .tool-meta span:last-child {
        color: var(--text-secondary);
        font-size: 0.95rem;
      }

      .breadcrumb {
        font-size: 0.95rem;
        margin-bottom: 16px;
        padding-top: 40px;
      }

      .breadcrumb a {
        color: var(--link-color);
        text-decoration: none;
      }

      .tool-header {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        gap: 16px;
        flex-wrap: wrap;
      }

      .tool-header h2 {
        margin: 0;
      }

      textarea {
        width: 100%;
        min-height: 140px;
        border-radius: 12px;
        border: 1px solid var(--border-color);
        padding: 12px;
        font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, monospace;
        resize: vertical;
        background: var(--bg-card);
        color: var(--text-primary);
      }

      .helper {
        margin: 12px 0 0;
        color: var(--text-tertiary);
        font-size: 0.95rem;
      }

      .link-button {
        background: none;
        border: 0;
        padding: 0;
        color: var(--link-color);
        text-decoration: underline;
        cursor: pointer;
        font: inherit;
      }

      .link-button:hover {
        color: var(--link-hover);
      }

      .tool-grid {
        display: grid;
        gap: 20px;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        margin-top: 20px;
      }

      .output {
        background: var(--bg-output);
        border-radius: 12px;
        padding: 12px;
        font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, monospace;
        min-height: 140px;
        white-space: pre-wrap;
        word-break: break-word;
        color: var(--text-primary);
      }

      .status {
        color: var(--text-tertiary);
        font-size: 0.95rem;
      }

      .error {
        color: var(--error-color);
      }
    </style>
  </head>
  <body>
    <header>
      <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode">
        <span id="theme-icon">‚òÄÔ∏è</span>
        <span id="theme-text">Light</span>
      </button>
      <h1></h1>
      
    </header>

    <main>
      <div class="breadcrumb" style="margin-bottom: 16px; padding-left: 2px;"><a href="../../">‚Üê Back to tool index</a></div>

<h1>UK Commute Coverage Analyser</h1>
<p>A client-side web tool for analyzing mobile data coverage from UK networks (EE, Vodafone, O2, Three) along any route. Perfect for finding the best network for your daily commute.</p>
<h2>Features</h2>
<ul>
<li><strong>Route Analysis</strong>: Compare mobile coverage from EE, Vodafone, O2, and Three along any UK route.</li>
<li><strong>Multi-Network Comparison</strong>: Compare all 4 major UK networks simultaneously.</li>
<li><strong>Smart Sampling</strong>: Samples 500 evenly-spaced points along your journey for accurate coverage mapping.</li>
<li><strong>Visual Feedback</strong>: Step-by-step progress indicators and real-time error reporting.</li>
<li><strong>Interactive Visualization</strong>: Dynamic line chart showing coverage levels across the route.</li>
<li><strong>Summary Statistics</strong>: Table showing best networks with coverage percentages and rankings.</li>
</ul>
<h2>How to Use</h2>
<ol>
<li>Enter your start and end UK postcodes.</li>
<li>Select your travel mode (Driving, Cycling, or Walking).</li>
<li>Provide your Google Maps API key (ensure Geocoding, Directions, and Maps JavaScript APIs are enabled).</li>
<li>Click <strong>Analyse Route Coverage</strong> to start the analysis.</li>
</ol>
<h2>Technical Implementation</h2>
<p>The tool uses Ofcom's tile-based coverage API, fetching pre-rendered PNG tiles and extracting coverage information directly from pixel colors.</p>
<h3>Workflow</h3>
<ol>
<li><strong>Geocoding</strong>: Uses Google Geocoding API to convert postcodes to coordinates.</li>
<li><strong>Routing</strong>: Uses Google Directions API to calculate the path between points.</li>
<li><strong>Sampling</strong>: Samples 500 coordinates at regular intervals using the Haversine formula.</li>
<li><strong>Coordinate Mapping</strong>: Converts geographic coordinates (WGS84) to British National Grid (BNG) to match Ofcom's tile system.</li>
<li><strong>Tile Analysis</strong>:
<ul>
<li>Fetch PNG tile for each of 4 operators.</li>
<li>Extract pixel color at the precise BNG coordinate using the Canvas API.</li>
<li>Map colors to official Ofcom coverage levels (0-4) with ¬±10 RGB tolerance.</li>
</ul>
</li>
<li><strong>Visualization</strong>: Renders results using Chart.js, Google Maps, and dynamic HTML tables.</li>
</ol>
<h3>Module Structure</h3>
<pre><code>tools/uk-commute-coverage/
‚îú‚îÄ‚îÄ index.md                          # Tool UI (form + styling)
‚îú‚îÄ‚îÄ main.mjs                          # Application entry point &amp; UI glue
‚îú‚îÄ‚îÄ coverage-analyzer.mjs             # Main orchestration &amp; Google API integration
‚îú‚îÄ‚îÄ google-map.mjs                    # Google Maps API integration
‚îú‚îÄ‚îÄ route-sampler.mjs                 # Route interpolation (haversine distance)
‚îú‚îÄ‚îÄ tile-coverage-adapter.mjs          # Ofcom tile API integration &amp; caching
‚îú‚îÄ‚îÄ coordinate-converter.mjs           # WGS84 ‚Üî British National Grid conversion
‚îú‚îÄ‚îÄ chart-renderer.mjs                # Chart.js visualization wrapper
‚îú‚îÄ‚îÄ constants.mjs                     # Shared constants (API URLs, zoom levels)
‚îú‚îÄ‚îÄ coverage-analyzer.test.mjs        # Tests for analyzer logic (with Google mocks)
‚îú‚îÄ‚îÄ route-sampler.test.mjs            # Tests for sampling algorithms
‚îú‚îÄ‚îÄ route-visualizer.test.mjs         # Integration tests for route preview
‚îî‚îÄ‚îÄ README.md                         # This file
</code></pre>
<h3>Key Components</h3>
<h4>1. Route Sampling (<code>route-sampler.mjs</code>)</h4>
<ul>
<li><strong>Haversine distance</strong>: Great-circle distance calculation between GPS points.</li>
<li><strong>Linear interpolation</strong>: Samples route at fixed intervals or fixed point count (default 500).</li>
<li><strong>Functions</strong>: <code>haversineDistance()</code>, <code>sampleRoute()</code>, <code>sampleRouteByCount()</code>, <code>getTotalDistance()</code>.</li>
</ul>
<h4>2. Coordinate Conversion (<code>coordinate-converter.mjs</code>)</h4>
<ul>
<li><strong>WGS84 ‚Üî BNG</strong>: Converts latitude/longitude to British National Grid coordinates using <code>proj4</code>.</li>
<li><strong>Tile coordinates</strong>: Calculates which tile (x, y) at zoom 10 contains a given coordinate.</li>
<li><strong>Pixel position</strong>: Calculates exact pixel within a 256√ó256 tile.</li>
<li><strong>Precision</strong>: Accurate to ~5.6 meters at zoom level 10.</li>
</ul>
<h4>3. Tile Coverage Adapter (<code>tile-coverage-adapter.mjs</code>)</h4>
<ul>
<li><strong>Ofcom API</strong>: Fetches PNG tiles from Ofcom's raster BNG servers.</li>
<li><strong>Operators</strong>: mno1=Vodafone, mno2=O2, mno3=EE, mno4=Three.</li>
<li><strong>Caching</strong>: Tiles cached in localStorage and IndexedDB to minimize repeat API calls.</li>
<li><strong>Color extraction</strong>: Uses Canvas API to read pixel colors from tiles.</li>
<li><strong>Color matching</strong>: Maps pixel colors to coverage levels (0-4) with configurable tolerance.</li>
</ul>
<h2>Coverage Levels</h2>
<p>The tool returns 5 coverage levels based on Ofcom tile colors:</p>
<table>
<thead>
<tr>
<th>Level</th>
<th>Hex</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>4</td>
<td>#7d2093</td>
<td>Good outdoor and in-home</td>
</tr>
<tr>
<td>3</td>
<td>#cd7be4</td>
<td>Good outdoor, variable in-home</td>
</tr>
<tr>
<td>2</td>
<td>#0081b3</td>
<td>Good outdoor</td>
</tr>
<tr>
<td>1</td>
<td>#83e5f6</td>
<td>Variable outdoor</td>
</tr>
<tr>
<td>0</td>
<td>#d4d4d4</td>
<td>Poor to none outdoor</td>
</tr>
</tbody>
</table>
<p><strong>Color tolerance</strong>: ¬±10 on RGB values (configurable in <code>tile-coverage-adapter.mjs</code>)</p>
<h2>Development</h2>
<h3>Setup</h3>
<pre><code class="language-bash">npm install
</code></pre>
<h3>Running Tests</h3>
<pre><code class="language-bash">npm test
</code></pre>
<p>Tests verify:</p>
<ul>
<li>Route sampling accuracy (haversine distance, point interpolation)</li>
<li>Coordinate conversion (WGS84 ‚Üí BNG ‚Üí tile ‚Üí pixel)</li>
<li>Google API integration (via mocks for Geocoder and DirectionsService)</li>
<li>Color extraction and matching (RGB/hex conversion, tolerance matching)</li>
</ul>
<h3>Modifying the Tool</h3>
<h4>Changing Coverage Levels</h4>
<p>Update the <code>colorMap</code> in the <code>TileCoverageAdapter</code> constructor in <code>tile-coverage-adapter.mjs</code>:</p>
<pre><code class="language-javascript">this.colorMap = {
  4: '#7d2093', // Modify hex colors here
  // ...
};
</code></pre>
<h4>Adjusting Color Tolerance</h4>
<p>In <code>tile-coverage-adapter.mjs</code>, modify the tolerance parameter in <code>mapColorToCoverageLevel</code>:</p>
<pre><code class="language-javascript">mapColorToCoverageLevel(hex, tolerance = COLOR_TOLERANCE)
</code></pre>
<h4>Changing Sampling Density</h4>
<p>In <code>constants.mjs</code>, modify the <code>ROUTE_SAMPLE_COUNT</code>:</p>
<pre><code class="language-javascript">export const ROUTE_SAMPLE_COUNT = 500; // Change to desired count
</code></pre>
<h2>Architecture Notes</h2>
<h3>Why Tiles Instead of Postcode API?</h3>
<p>The original tool used a postcode-based API that required reverse-geocoding sampled points back to postcodes. The tile-based approach:</p>
<ul>
<li>Eliminates postcode reverse-geocoding step (fewer API calls).</li>
<li>Provides continuous coverage data (not just per-postcode).</li>
<li>Uses visual data (colors) directly from Ofcom's public tile server.</li>
<li>Enables more granular coverage representation (5 levels vs. binary).</li>
</ul>
<h3>Why Canvas API for Pixel Extraction?</h3>
<p>Extracts colors directly from PNG data without external image processing library:</p>
<ul>
<li>Works in all browsers (no server-side processing needed).</li>
<li>No dependency on Sharp or other Node.js libraries.</li>
<li>Efficient memory usage (single pixel read, not full image processing).</li>
</ul>
<h3>Coordinate System Details</h3>
<p>Uses British National Grid (EPSG:27700) instead of Web Mercator:</p>
<ul>
<li>Ofcom tiles use BNG projection.</li>
<li>Accurate for UK-specific distance calculations.</li>
<li>Requires <code>proj4</code> for accurate transformation.</li>
<li>Tile grid origin: (0, 0) at southwest; Y increases northward.</li>
</ul>
<h2>Performance</h2>
<ul>
<li><strong>Tile Caching</strong>: PNG tiles stored in browser cache (localStorage + IndexedDB).</li>
<li><strong>Batch Processing</strong>: Analysis throttled to batches of 5 points to ensure browser responsiveness.</li>
<li><strong>Typical Performance</strong>: Analysis takes 15-45 seconds depending on route complexity and cache status.</li>
</ul>
<h2>Limitations &amp; Future Work</h2>
<h3>Current Limitations</h3>
<ul>
<li>Requires active internet connection for Google APIs and Ofcom tiles.</li>
<li>Google Maps API usage is subject to your own API quota and billing.</li>
<li>Ofcom tile API may not cover all UK areas equally.</li>
</ul>
<h3>Future Improvements</h3>
<ul>
<li>Service worker for offline tile caching.</li>
<li>Export route coverage as KML/GeoJSON.</li>
<li>Historical coverage tracking (if Ofcom versioning available).</li>
</ul>
<h2>Browser Compatibility</h2>
<ul>
<li><strong>Modern browsers</strong>: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+.</li>
<li><strong>Required features</strong>:
<ul>
<li>Canvas API (pixel data extraction)</li>
<li>localStorage/IndexedDB (tile caching)</li>
<li>Fetch API (tile fetching)</li>
<li>ES6 JavaScript (Modules, arrow functions, etc.)</li>
</ul>
</li>
</ul>


    </main>

    <footer style="text-align:center; padding:18px 24px; color:var(--text-secondary); font-size:0.9rem;">
      <div class="card" style="max-width:1080px; margin: 0 auto 32px; background:transparent; box-shadow:none; border:none; padding:0;">
        <small>Site version: <strong>20260122.2201</strong></small>
      </div>
    </footer>

    <script>
      (function() {
        const toggle = document.getElementById('theme-toggle');
        const icon = document.getElementById('theme-icon');
        const text = document.getElementById('theme-text');
        const root = document.documentElement;

        // Check for saved theme preference or default to light mode
        const savedTheme = localStorage.getItem('theme') || 'light';

        function setTheme(theme) {
          if (theme === 'dark') {
            root.classList.add('dark-mode');
            icon.textContent = 'üåô';
            text.textContent = 'Dark';
          } else {
            root.classList.remove('dark-mode');
            icon.textContent = '‚òÄÔ∏è';
            text.textContent = 'Light';
          }
          localStorage.setItem('theme', theme);
        }

        // Apply saved theme on page load
        setTheme(savedTheme);

        // Toggle theme on button click
        toggle.addEventListener('click', function() {
          const currentTheme = root.classList.contains('dark-mode') ? 'dark' : 'light';
          const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
          setTheme(newTheme);
        });
      })();
    </script>
  </body>
</html>
